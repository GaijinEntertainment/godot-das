#!/usr/bin/env python

import subprocess


das_inject_list = [
    "src/godot.das",
]

for filename in das_inject_list:
    process = subprocess.Popen(["xxd", "-i", filename, f"{filename}.inc"], stdout=subprocess.PIPE)
    process.wait()

Import("env")

env_dascript = env.Clone()

src_list = [
    "register_types.cpp",
    "src/init_dascript.cpp",
    "src/das_script.cpp",
    "src/das_script_language.cpp",
    "src/das_script_instance.cpp",
    "src/das_resource_format_saver.cpp",
    "src/das_resource_format_loader.cpp",
]
env_dascript.Append(CCFLAGS=["-w"]) # TODO suspend only warnings in daScript headers
env_dascript.Append(CPPPATH=["src", "daScript/include"])
env_dascript.add_source_files(env.modules_sources, src_list)

 # for some reason, LIBS and LIBPATH combonation works only for absolute paths
dascript_lib = File("daScript/liblibDaScript.a")
env.Append(LIBS=[dascript_lib])
